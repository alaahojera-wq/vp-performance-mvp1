{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row-actions" style="justify-content:space-between">
    <div>
      <h2>Dashboard</h2>
      <p class="small">Select a term and a VP to view metrics, enter actual values, and review the weighted scores.</p>
    </div>
    <form method="get" action="/dashboard" class="row-actions">
      <label class="small">Term</label>
      <select name="term" onchange="this.form.submit()">
        {% for t in terms %}
          <option value="{{ t.name }}" {% if t.name == term %}selected{% endif %}>
            {{ t.name }}{% if t.is_active %} (Active){% endif %}{% if t.locked %} â€¢ Locked{% endif %}
          </option>
        {% endfor %}
      </select>
    </form>
  </div>
  <div class="kpi">
    <div class="item"><div class="small">Term</div><div><strong>{{ term }}</strong></div></div>
    <div class="item"><div class="small">VPs</div><div><strong>{{ vps|length }}</strong></div></div>
    <div class="item"><div class="small">Term status</div><div><strong>{{ "Locked" if term_locked else "Open" }}</strong></div></div>
  </div>
</div>

<div class="card">
  <h3>VPs</h3>
  <table>
    <thead><tr><th>Name</th><th>Phase</th><th>Email</th><th>Overall</th><th></th></tr></thead>
    <tbody>
      {% for vp in vps %}
      <tr>
        <td><strong>{{ vp.name }}</strong></td>
        <td>{{ vp.phase or "-" }}</td>
        <td class="small">{{ vp.email or "-" }}</td>
        <td>
          {% if vp.overall_label %}
            <span class="badge">{{ vp.overall_label }}</span>
            <span class="small">({{ "%.2f"|format(vp.overall_score) }})</span>
          {% else %}
            <span class="small">Incomplete</span>
          {% endif %}
        </td>
        <td><a class="btn secondary" href="/vp/{{ vp.id }}?term={{ term }}">Open</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
